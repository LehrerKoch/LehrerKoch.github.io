<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script id="MathJax-script"
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <title>Graphen erkennen</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <style>
  
    /* Container für die gesamte Interaktionsfläche */
    #cardArea {
      position: relative;
      width: 100%;
      /* Nutzt den verfügbaren Platz, lässt aber Raum für Header und Lösung */
      height: 50vh; 
      margin: 10px auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #cardContainer {
      cursor: grab;
      transition: transform 0.3s ease, background-color 0.3s ease;
      border-radius: 15px; 
      /* Wichtig: Breite einschränken, damit Platz für Buttons bleibt */
      width: 60%; 
      height: 100%;
      z-index: 2;
      display: flex;
      justify-content: center; 
      align-items: center;
      touch-action: none;
      overflow: hidden; /* Verhindert, dass Bilder überstehen */
    }

    #cardImage {
      /* Das Bild füllt den Container maximal aus, ohne verzerrt zu werden */
      max-width: 100%;
      max-height: 100%;
      object-fit: contain; 
      pointer-events: none; 
    }

    #loesung {
      width: 100%;
      text-align: center;
    }

  </style>
</head>
<body>
  <h1>Graphen zuordnen</h1>

  
  ️<p>Gib die passende Funktionsgleichung zum abgebildeten Graphen an.</p>
  <p></p>
  <p id="counter" style="font-weight:bold;"></p>
  <div id="cardArea">

  <button id="wrongBtn" onclick="markAnswer(false)"
          style="position: absolute; left: 0; top: 0; bottom: 0;
                background-color:#f8d7da; color:#721c24; border:none; border-radius:5px;
                display:none; width:12vw; min-width: 80px; font-size:0.9em; z-index: 1;">
    Noch unsicher
  </button>

  <div id="cardContainer">
    <img id="cardImage" src="" alt="Flashcard">
  </div>

  <button id="correctBtn" onclick="markAnswer(true)"
          style="position: absolute; right: 0; top: 0; bottom: 0;
                background-color:#d4edda; color:#155724; border:none; border-radius:5px;
                display:none; width:12vw; min-width: 80px; font-size:0.9em; z-index: 1;">
    Kann ich sicher
  </button>

</div>

</div>

<div style="position: relative; width: 100%; height: 120px; margin-top: 20px;">
  
<button id="showloesungBtn" style="display:none; width: 100%;">Lösung anzeigen</button>
<p id="loesung" style="font-size:2em; text-align:center; margin-top:10px;"></p>
</div>

<p> </p>
<script>

  const cards = [
    {img: "Graphen/1t.png", loesung: "\\(f(x)=1\\)"},
    {img: "Graphen/sqrtt.png", loesung: "\\(f(x)=\\sqrt{x}\\)"},
    {img: "Graphen/sint.png", loesung: "\\(f(x)=\\sin(x)\\)"},
    {img: "Graphen/x2t.png", loesung: "\\(f(x)=x^2\\)"},
    {img: "Graphen/x3t.png", loesung: "\\(f(x)=x^3\\)"},
    {img: "Graphen/xt.png", loesung: "\\(f(x)=x\\)"},
    {img: "Graphen/cost.png", loesung: "\\(f(x)=\\cos(x)\\)"},
    {img: "Graphen/lnt.png", loesung: "\\(f(x)=\\ln(x)\\)"},
    {img: "Graphen/et.png", loesung: "\\(f(x)=e^x\\)"},
    {img: "Graphen/1_xt.png", loesung: "\\(f(x)=\\frac{1}{x}\\)"},
    {img: "Graphen/1_x2t.png", loesung: "\\(f(x)=\\frac{1}{x^2}\\)"}
  ];

let correctCount = 0;
let totalCount = 0;
let lastCard = null;
let currentCard = null;

const imgEl = document.getElementById("cardImage");
const loesungEl = document.getElementById("loesung");
const counterEl = document.getElementById("counter");
const wrongBtn = document.getElementById("wrongBtn");
const correctBtn = document.getElementById("correctBtn");
const showloesungBtn = document.getElementById("showloesungBtn");

function updateCounter() {
  counterEl.textContent = `Richtig: ${correctCount} / ${totalCount}`;
}

let taskPool = [...cards];

function pickRandomCard() {
  if (taskPool.length === 0) taskPool = [...cards]; // Pool ggf. zurücksetzen

  let card;
  if (taskPool.length === 1) {
    card = taskPool[0]; // einzige Karte im Pool → darf wiederkommen
  } else {
    do {
      const idx = Math.floor(Math.random() * taskPool.length);
      card = taskPool[idx];
    } while (card === lastCard); // gleiche Karte wie zuletzt vermeiden
  }

  lastCard = card;
  currentCard = card;

  imgEl.src = card.img;
  loesungEl.innerHTML = "";
  showloesungBtn.style.display = "inline-block";
  wrongBtn.style.display = "inline-block";
  correctBtn.style.display = "inline-block";

  MathJax.typeset();
}


let locked = false;

function markAnswer(correct) {
  if (!currentCard || locked) return;
  locked = true;

  totalCount++;
  if (correct) {
    correctCount++;

    // Karte nur entfernen, wenn korrekt
    const idx = taskPool.indexOf(currentCard);
    if (idx !== -1) taskPool.splice(idx, 1);
  }

  loesungEl.innerHTML = currentCard.loesung;
  MathJax.typeset();
  flashResult(correct ? "lightgreen" : "lightcoral");
  updateCounter();

  setTimeout(() => {
    loesungEl.innerHTML = "";
    locked = false;
    pickRandomCard();
  }, 1000);
}

function toggleloesung() {
  if (!currentCard) return;

  const loesungEl = document.getElementById("loesung");

  if (loesungEl.innerHTML === "") {
    loesungEl.innerHTML = currentCard.loesung;
  } else {
    loesungEl.innerHTML = "";
  }

  MathJax.typeset();
}


// Flash-Effekt
function flashResult(color) {
  const body = document.body;
  body.style.transition = "none";
  body.style.backgroundColor = color;
  setTimeout(() => {
    body.style.transition = "background-color 1s";
    body.style.backgroundColor = "white";
  }, 50);
}

// Eventlistener für Buttons
correctBtn.addEventListener("click", () => {
    markAnswer(true);
    correctBtn.blur(); // Fokus entfernen
});

wrongBtn.addEventListener("click", () => {
    markAnswer(false);
    wrongBtn.blur(); // Fokus entfernen
});

showloesungBtn.addEventListener("click", () => {
    toggleloesung();
    showloesungBtn.blur(); // Fokus entfernen
});

// Tastatursteuerung
document.addEventListener("keydown", (e) => {
  if (e.code === "Space") toggleloesung();
  else if (e.code === "ArrowRight" || e.key.toUpperCase() === "D") markAnswer(true);
  else if (e.code === "ArrowLeft"  || e.key.toUpperCase() === "A") markAnswer(false);
});

// --- Drag Logik verbessert ---
  const cardContainer = document.getElementById("cardContainer");
  let startX = null;
  let currentX = 0;

  function updateFormulaPosition(dx) {
      cardContainer.style.transform = `translateX(${dx}px)`;
      cardContainer.style.boxShadow = `${dx/10}px ${Math.abs(dx)/10}px 10px rgba(0,0,0,0.2)`;

      const maxDistance = 150; 
      let intensity = Math.min(Math.abs(dx) / maxDistance, 1);
      if (dx > 0) {
          cardContainer.style.backgroundColor = `rgba(0, 255, 0, ${intensity*0.3})`;
      } else if (dx < 0) {
          cardContainer.style.backgroundColor = `rgba(255, 0, 0, ${intensity*0.3})`;
      } else {
          cardContainer.style.backgroundColor = "transparent";
      }
  }

  cardContainer.addEventListener("mousedown", (e) => {
      startX = e.clientX;
      cardContainer.style.transition = "none";
      cardContainer.style.cursor = "grabbing";
  });

  document.addEventListener("mousemove", (e) => {
      if (startX === null) return;
      currentX = e.clientX - startX;
      updateFormulaPosition(currentX);
  });

  document.addEventListener("mouseup", () => {
      if (startX === null) return;
      if (currentX > 80) markAnswer(true);
      else if (currentX < -80) markAnswer(false);
      
      cardContainer.style.transition = "transform 0.3s ease, background-color 0.3s ease";
      cardContainer.style.transform = "translateX(0)";
      cardContainer.style.boxShadow = "none";
      cardContainer.style.backgroundColor = "transparent";
      cardContainer.style.cursor = "grab";
      startX = null;
      currentX = 0;
  })

  cardContainer.addEventListener("touchstart", (e) => {
      const touch = e.touches[0];
      startX = touch.clientX;
      cardContainer.style.transition = "none";
      cardContainer.style.cursor = "grabbing";
      e.preventDefault();
  }, { passive: false });

  document.addEventListener("touchmove", (e) => {
      if (startX === null) return;
      const touch = e.touches[0];
      currentX = touch.clientX - startX;
      updateFormulaPosition(currentX);
      e.preventDefault();
  }, { passive: false });

  document.addEventListener("touchend", (e) => {
      if (startX === null) return;

      if (currentX > 80) markAnswer(true);
      else if (currentX < -80) markAnswer(false);

      cardContainer.style.transition = "transform 0.3s ease, background-color 0.3s ease";
      cardContainer.style.transform = "translateX(0)";
      cardContainer.style.boxShadow = "none";
      cardContainer.style.backgroundColor = "transparent";
      cardContainer.style.cursor = "grab";

      startX = null;
      currentX = 0;
  });


// Initial starten
updateCounter();
pickRandomCard();



</script>

</body>
</html>
